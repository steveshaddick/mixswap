{% extends 'base.html' %}
{% block page_class %}mix-page{% endblock %}


{% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

{% block content %}
<h1></h1>
<div id="back">
	<a href="{% url 'home' %}"><span style="font-size:50px;">&laquo;</span> <span style="line-height: 38px;margin-top: 5px;text-transform: uppercase;vertical-align: top;">home</span></a>
</div>

<div id="contentWrapper">
    <header>
        <span id="mixTitle">{{ mix.title }}</span><br />
        <span id="mixUserName">by {{ user.first_name }}</span>
        <span id="mixDownload"><a href="{{ 'download' }}">download</a></span>
    </header>
    
    <nav>
    </nav>
    
    <section id="scnAudioPlayer">
        <audio id="audioElement" src="" controls="controls">
            Your browser does not support the audio tag.
        </audio>
         <div id="currentTrackInfo">
	        <span id="currentTitle"></span><br /><span id="currentArtist"></span>
        </div>
    </section>
    
    <section id="scnMixList">
        <div id="songList"></div>
    </section>
    
    <section id="scnAddTrack">
    	<h1>Add song</h1>
        <form id="frmUploadSong" action="{{ 'upload mix' }}" enctype="multipart/form-data" method="POST" target="iUpload">
			<input id="songFiles" type="file" name="songFiles" size="20" multiple>
            <input id="btnUploadSong" type="button" value="Upload">
        </form>
        <br />
        <!--<h2>FTP Upload: </h2>
        <span class="ftpUpload">Mix #<?=$mixId?> <a href="php/ftpRefresh.php?m=<?=$mixId?>" id="ftpRefreshLink">FTP Refresh</a></span>-->
    </section>
    
    
    <section id="scnPublishMix">
        <a href="#" id="aPublishMix"></a>
    </section>
    
    <section id="scnComments">
    	<h1>Comment</h1>
        <div id="divAddComment">
        	<textarea id="txtAddComment" rows="3" cols="40"></textarea>
            <button id="btnAddComment">Add</button>
        </div>
        <div id="divCommentsList"></div>
    </section>
    
</div>


{% if is_user_mix %}
    <p>My mix!</p>
{% endif %}

<section id="scnChangeBG">
    <h1>Change background picture</h1>
    <form id="uploadPictureForm" action="{% url 'mixes:upload_picture' mix.pk %}" enctype="multipart/form-data" method="POST">
        <div id="picUploader">There's a problem, this isn't going to work.</div>
    </form>
</section>

<footer>
</footer>

<section id="classRef" style="display:none; visibility:hidden; height:0; width:0;">
	
    <div id="refSongItem" class="songItem" draggable="false">
		<div class="divDrag"><a class="hitDrag" href="#" onClick="return false;">&bull;</a></div>           
        <div class="divFavourite"><input id="chkFavourite" name="chkFavourite" class="chkFavourite" title="Favourite Track" type="checkbox" /></div>
        <div class="divSong"><span class="songTrack"></span>. <a class="songLink" href="#"><span class="songTitle"></span> - <span class="songArtist"></span></a><span class="favCount"></span></div>
        <div class="divSongDelete"><a class="songDeleteLink" href="#" onClick="return false;">x</a><a class="songEditLink" href="#" onClick="return false;">[edit]</a></div>
    </div>
    
    <article id="refCommentItem" class="commentItem">
    	<span class="commentUserName"></span> <time class="commentTime" datetime=""></time><br />
        <span class="commentText"></span>
    </article>
    
   <iframe id="iUpload" name="iUpload" src="#" style="display:none;visibility:hidden;width:0;height:0;"></iframe> 

</section>

<script type="text/javascript">

    mix = new Mix({{ mix.id }}, {% if is_user_mix %}true{% else %}false{% endif %}, {% if mix.is_published %}true{% else %}false{% endif %}, '{{ mix.picture_file }}');

    {% for song in mix.songs.all %}
        mix.addSong({{ song.id }}, "{{ song.artist }}", "{{ song.title }}", "{{ song.song_prefix }}", {% if user in song.favourites %}true{% else %}false{% endif %}, {{ song.favourites.all|length }});
    {% endfor %}

    {% for comment in mix.comment_set.all %}
        mix.addComment("{{ comment.user.first_name }}", "{{ comment.date }}", "{{ comment.text|linebreaks }}");
        {# str_replace(\n, ) #}
    {% endfor %}


</script>

{% endblock %}